<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zipdoc.dev.mapper.PasteMapper">

	<!-- paste 등록 -->
	<insert id="insertPaste" parameterType="RequestVo">
		INSERT INTO tb_paste (
			pasteUrl,
			pasteText,
			pasteExpiration,
			expireDt,
			pasteNameTitle
		)VALUES(
			#{data.pasteVo.pasteUrl},
			#{data.pasteVo.pasteText},
			#{data.pasteVo.pasteExpiration},
			<if test="data.pasteVo.pasteExpiration eq 'N'.toString()">
				date_add(now(),INTERVAL 9999 MONTH),
			</if>
			<if test="data.pasteVo.pasteExpiration eq '10M'.toString()">
				date_add(now(),INTERVAL 10 MINUTE),
			</if>
			<if test="data.pasteVo.pasteExpiration eq '1H'.toString()">
				date_add(now(),INTERVAL 1 HOUR),
			</if>
			<if test="data.pasteVo.pasteExpiration eq '1D'.toString()">
				date_add(now(),INTERVAL 1 DAY),
			</if>
			<if test="data.pasteVo.pasteExpiration eq '1W'.toString()">
				date_add(now(),INTERVAL 1 WEEK),
			</if>
			<if test="data.pasteVo.pasteExpiration eq '2W'.toString()">
				date_add(now(),INTERVAL 2 WEEK),
			</if>
			<if test="data.pasteVo.pasteExpiration eq '1M'.toString()">
				date_add(now(),INTERVAL 1 MONTH),
			</if>
			<if test="data.pasteVo.pasteExpiration eq '2M'.toString()">
				date_add(now(),INTERVAL 2 MONTH),
			</if>
			<if test="data.pasteVo.pasteExpiration eq '6M'.toString()">
				date_add(now(),INTERVAL 6 MONTH),
			</if>
			<if test="data.pasteVo.pasteExpiration eq '1Y'.toString()">
				date_add(now(),INTERVAL 1 YEAR),
			</if>
			#{data.pasteVo.pasteNameTitle}
		)
	</insert>

	<!-- 등록된 paste 조회 -->
	<select id="selectPaste" parameterType="String" resultType="PasteVo">
		SELECT pasteSeqNo,
			   pasteText,
			   pasteExpiration,
			   expireDt,
			   pasteNameTitle,
			   pasteUrl,
			   delYn,
			   regDt,
			   edtDt
		  FROM tb_paste
		 WHERE pasteUrl = #{pasteUrl}
		   AND delYn = 0
		   AND DATE(expireDt) >= now()
	</select>

	<!-- paste 삭제 처리 -->
	<update id="deletePaste" parameterType="Long">
		UPDATE tb_paste
		  SET delYn = 1,
		      edtDt = NOW()
		WHERE pasteSeqNo = #{pasteSeqNo}
	</update>
</mapper>
